<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kcc.vacation.domain.employee.mapper.EmployeeMapper">

    <select id="findById" parameterType="int" resultType="Employee" >
        select * from employee e where e.id = #{id}
    </select>

    <select id="findByEmail" parameterType="String" resultType="Employee" >
        select * from employee e where e.email = #{email}
    </select>

    <select id="findByOauthId" parameterType="String" resultType="Employee" >
        select * from employee e where e.oauth_id = #{oauthId}
    </select>


<!--    <insert id="save" parameterType="EmployeeCreate">

        <selectKey order="BEFORE" keyProperty="id" resultType="int">
            select employee_seq.nextval from dual
        </selectKey>

        INSERT INTO Employee(id, name, hire_date, email,password, phone_number, vacation_days, join_state)
        VALUES (#{id}, #{name}, systimestamp, #{email},#{password}, #{phoneNumber}, #{vacationDays}, 'FALSE')

    </insert>-->
    <insert id="save" parameterType="EmployeeCreate">

        <selectKey order="BEFORE" keyProperty="id" resultType="int">
            select employee_seq.nextval from dual
        </selectKey>

        INSERT INTO Employee (
        id,
        name,
        hire_date,
        oauth_id,
        email,
        password,
        phone_number,
        vacation_days,
        join_state
        )
        VALUES (
        #{id},
        #{name, jdbcType=VARCHAR},
        systimestamp,
        #{oauthId, jdbcType=VARCHAR},
        #{email, jdbcType=VARCHAR},
        #{password, jdbcType=VARCHAR},
        #{phoneNumber, jdbcType=VARCHAR},
        #{vacationDays, jdbcType=INTEGER},
        'FALSE'
        )

    </insert>
    <resultMap id="myInfoResultMap" type="com.kcc.vacation.domain.employee.dto.response.MyInfo">
        <id column="id" property="id"/>
        <result column="empName" property="empName"/>
        <result column="deptName" property="deptName"/>
        <result column="position" property="position"/>
        <result column="hire_date" property="hireDate"/>
        <result column="phone_number" property="phoneNumber"/>
        <result column="email" property="email"/>
    </resultMap>

    <select id="getMyInfo" resultMap="myInfoResultMap">
        SELECT e.id, e.name AS empName, d.name AS deptName, e.position, e.hire_date, e.phone_number, e.email
        FROM employee e
        JOIN department d ON e.dept_id = d.id
        WHERE e.id = #{employeeId}
    </select>

    <update id="updateMyInfo">
        UPDATE employee SET phone_number = #{updateMyInfo.phoneNumber}, email = #{updateMyInfo.email}
        WHERE id = #{updateMyInfo.id}
    </update>


    <update id="updateSocialData" parameterType="EmployeeSocialDataUpdate">
        update employee set oauth_id = #{oauthId}, join_state = 'TRUE'
        where id = #{id}
    </update>

    <update id="updateFormLoginData" parameterType="EmployeeFormLoginDataUpdate">
        update employee
        set
        phone_number = #{phoneNumber, jdbcType=VARCHAR},
        password = #{password, jdbcType=VARCHAR},
        join_state = 'TRUE'
        where id = #{id}
    </update>

    <update id="updateAuthenticationCode" parameterType="EmployeeAuthenticationCodeUpdate">
        update employee set authentication_code = #{authenticationCode}
        where id = #{id}
    </update>

    <update id="updateVerified" parameterType="EmployeeVerifiedUpdate">
        update employee set verified = #{verified}
        where email = #{email}
    </update>
</mapper>
